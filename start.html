<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .config-section {
            padding: 25px;
            border-bottom: 1px solid #eee;
        }

        .config-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #3498db;
        }

        .control-section {
            padding: 25px;
            text-align: center;
        }

        .server-status {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
        }

        .status-card {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-offline { 
            background: #e74c3c; 
            animation: pulse-offline 2s infinite;
        }
        .status-online { 
            background: #2ecc71; 
            animation: pulse-online 2s infinite;
        }
        .status-starting { 
            background: #f39c12; 
            animation: pulse-starting 1s infinite;
        }
        .status-stopping { 
            background: #e67e22; 
            animation: pulse-starting 1s infinite;
        }
        .status-error { 
            background: #95a5a6; 
        }

        .status-text {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .status-details {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        @keyframes pulse-online {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @keyframes pulse-offline {
            0% { opacity: 0.5; }
            50% { opacity: 0.2; }
            100% { opacity: 0.5; }
        }

        @keyframes pulse-starting {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        .btn {
            padding: 16px 32px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            max-width: 300px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-start {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-check {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 12px 24px;
            font-size: 16px;
            max-width: 200px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .action-section {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }

        .action-log {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            margin-top: 15px;
            min-height: 60px;
            font-size: 14px;
            color: #2c3e50;
        }

        .log-success { color: #27ae60; }
        .log-error { color: #e74c3c; }
        .log-info { color: #3498db; }
        .log-warning { color: #f39c12; }

        .save-config {
            background: #9b59b6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            width: 100%;
        }

        .instructions {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 13px;
            color: #2c3e50;
            border-left: 4px solid #3498db;
        }

        .instructions h4 {
            margin-bottom: 8px;
            color: #2980b9;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .btn {
                width: 100%;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞</h1>
            <p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–æ–º —Å–µ—Ä–≤–µ—Ä–∞</p>
        </div>

        <div class="config-section">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
            <div class="form-group">
                <label for="panelUrl">URL –ø–∞–Ω–µ–ª–∏ Pterodactyl</label>
                <input type="url" id="panelUrl" placeholder="https://panel.yourdomain.com">
            </div>
            <div class="form-group">
                <label for="apiKey">API Key</label>
                <input type="password" id="apiKey" placeholder="ptlc_xxxxxxxxxxxx" value="ptlc_2X3xxuExXdy">
            </div>
            <div class="form-group">
                <label for="serverId">Server Identifier</label>
                <input type="text" id="serverId" placeholder="a1b2c3d4">
            </div>
            <button class="save-config" onclick="saveConfig()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            
            <div class="instructions">
                <h4>‚ÑπÔ∏è –ö–∞–∫ –Ω–∞–π—Ç–∏ Server Identifier:</h4>
                <p>1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Å–µ—Ä–≤–µ—Ä –≤ –ø–∞–Ω–µ–ª–∏ Pterodactyl<br>
                2. –í URL –±—É–¥–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä: <code>.../server/XXXXXXXX</code><br>
                3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ XXXX —á–∞—Å—Ç—å</p>
            </div>
        </div>

        <div class="control-section">
            <div class="server-status">
                <div class="status-card">
                    <span class="status-indicator status-offline" id="statusIndicator"></span>
                    <span class="status-text" id="statusText">–°—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω</span>
                </div>
                <div class="status-details" id="statusDetails">–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å" –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
            </div>

            <button class="btn btn-check" onclick="updateServerStatus()" id="btnCheck">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            <button class="btn btn-start" onclick="sendPowerSignal('start')" id="btnStart">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
        </div>

        <div class="action-section">
            <h3>üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            <div class="action-log" id="actionLog">
                <div class="log-info">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.</div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let config = {
            panelUrl: '',
            apiKey: 'ptlc_2X3xxuExXdy',
            serverId: ''
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ localStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function loadConfig() {
            const savedConfig = localStorage.getItem('pterodactylPanelConfig');
            if (savedConfig) {
                const saved = JSON.parse(savedConfig);
                config.panelUrl = saved.panelUrl || '';
                config.serverId = saved.serverId || '';
                
                document.getElementById('panelUrl').value = config.panelUrl;
                document.getElementById('apiKey').value = config.apiKey;
                document.getElementById('serverId').value = config.serverId;
                
                addLog('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
                updateServerStatus();
            } else {
                // –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω—è–µ–º API –∫–ª—é—á
                document.getElementById('apiKey').value = config.apiKey;
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function saveConfig() {
            config.panelUrl = document.getElementById('panelUrl').value.trim();
            config.serverId = document.getElementById('serverId').value.trim();

            if (!config.panelUrl || !config.serverId) {
                addLog('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', 'error');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ URL –∏ Server ID, API –∫–ª—é—á –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π
            const configToSave = {
                panelUrl: config.panelUrl,
                serverId: config.serverId
            };

            localStorage.setItem('pterodactylPanelConfig', JSON.stringify(configToSave));
            addLog('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            updateServerStatus();
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞
        async function sendPowerSignal(signal) {
            if (!validateConfig()) return;

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
            document.getElementById('btnStart').disabled = true;
            document.getElementById('btnCheck').disabled = true;

            addLog(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞...`, 'info');

            try {
                const response = await fetch(`${config.panelUrl}/api/client/servers/${config.serverId}/power`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${config.apiKey}`,
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ signal: signal })
                });

                if (response.ok) {
                    addLog(`–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...`, 'success');
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(updateServerStatus, 3000);
                } else {
                    const errorData = await response.json();
                    const errorMessage = errorData.errors?.[0]?.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    addLog(`–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ${errorMessage}`, 'error');
                }
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            } finally {
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    document.getElementById('btnStart').disabled = false;
                    document.getElementById('btnCheck').disabled = false;
                }, 2000);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞
        async function updateServerStatus() {
            if (!validateConfig()) return;

            document.getElementById('btnCheck').disabled = true;
            document.getElementById('btnCheck').textContent = 'üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞...';

            try {
                const response = await fetch(`${config.panelUrl}/api/client/servers/${config.serverId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${config.apiKey}`,
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    const serverData = await response.json();
                    const status = serverData.attributes.status || 'offline';
                    updateStatusDisplay(status);
                    addLog('–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                } else {
                    updateStatusDisplay('error');
                    addLog('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞', 'error');
                }
            } catch (error) {
                updateStatusDisplay('error');
                addLog(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: ${error.message}`, 'error');
            } finally {
                document.getElementById('btnCheck').disabled = false;
                document.getElementById('btnCheck').textContent = 'üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatusDisplay(status) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const statusDetails = document.getElementById('statusDetails');
            const startButton = document.getElementById('btnStart');

            const statusMessages = {
                'running': { 
                    text: '–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω', 
                    class: 'status-online',
                    details: '–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ',
                    buttonEnabled: false
                },
                'offline': { 
                    text: '–°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 
                    class: 'status-offline',
                    details: '–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É',
                    buttonEnabled: true
                },
                'starting': { 
                    text: '–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è', 
                    class: 'status-starting',
                    details: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...',
                    buttonEnabled: false
                },
                'stopping': { 
                    text: '–°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è', 
                    class: 'status-stopping',
                    details: '–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...',
                    buttonEnabled: false
                },
                'error': { 
                    text: '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 
                    class: 'status-error',
                    details: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏',
                    buttonEnabled: false
                }
            };

            const currentStatus = statusMessages[status] || statusMessages['offline'];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            indicator.className = 'status-indicator ' + currentStatus.class;
            statusText.textContent = currentStatus.text;
            statusDetails.textContent = currentStatus.details;
            startButton.disabled = !currentStatus.buttonEnabled;
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function validateConfig() {
            if (!config.panelUrl || !config.serverId) {
                addLog('–°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'warning');
                return false;
            }
            return true;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π
        function addLog(message, type = 'info') {
            const actionLog = document.getElementById('actionLog');
            const logEntry = document.createElement('div');
            logEntry.className = `log-${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            // –û—á–∏—â–∞–µ–º –ª–æ–≥ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3)
            const existingLogs = actionLog.getElementsByClassName(`log-${type}`);
            if (actionLog.children.length >= 3) {
                actionLog.removeChild(actionLog.children[0]);
            }
            
            actionLog.appendChild(logEntry);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
        function startStatusPolling() {
            setInterval(() => {
                if (validateConfig()) {
                    updateServerStatus();
                }
            }, 60000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            startStatusPolling();
            addLog('–ü–∞–Ω–µ–ª—å –∑–∞–ø—É—Å–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'info');
        });
    </script>
</body>
</html>
